# Server
PORT=4000
CORS_ORIGIN=http://localhost:3000

# Postgres
DATABASE_URL=postgres://user:password@localhost:5432/civilify_kb
PGSSL=false

# OpenAI
OPENAI_API_KEY=sk-...
# text-embedding-3-small => 1536 dims (default). If using -large, set vector(3072)
OPENAI_EMBEDDING_MODEL=text-embedding-3-small
OPENAI_CHAT_MODEL=gpt-4o

# Authentication
JWT_SECRET=your-super-secret-jwt-key-change-this-in-production

# RAG tuning
CHAT_TOP_K=12
CHAT_SIM_THRESHOLD=0.20
CHAT_CONF_THRESHOLD=0.18

# Structured Query Generation (SQG)
CHAT_USE_SQG=true
CHAT_SQG_MODEL=gpt-4o-mini
CHAT_SQG_TTL_MS=600000
CHAT_SQG_CACHE_MAX=300

# ===== NEW IMPROVEMENTS (Phase 1: Zero-Risk) =====

# 1. METADATA FILTERING
# Filter vector search by entry type, legal topics, jurisdiction (based on SQG)
# - Improves precision by 10-20%
# - Zero cost, zero latency overhead
# - Safe: just adds WHERE clauses to existing queries
# Set to 'false' if metadata filtering is too strict and missing results
CHAT_USE_METADATA_FILTERING=true
CHAT_METADATA_MIN_TOPICS=2

# 2. RERANKING
# Mode: 'none', 'cross-encoder', 'llm', 'hybrid'
# - cross-encoder: Fast (50-200ms), local, accurate (recommended)
# - llm: Slower (2-5s), uses OpenAI API, more flexible
# - hybrid: Try cross-encoder first, fallback to LLM
# - none: No reranking (default for backward compatibility)
CHAT_RERANK_MODE=none

# Cross-Encoder Reranking (fast, local, accurate)
CHAT_CROSS_ENCODER_HIGH_CONF=0.85    # Skip reranking if confidence > this
CHAT_CROSS_ENCODER_LOW_CONF=0.22     # Skip reranking if confidence < this
CHAT_CROSS_ENCODER_MAX_CANDIDATES=24 # Max candidates to rerank
CHAT_CROSS_ENCODER_TOP_N=8           # Return top N after reranking
CHAT_CROSS_ENCODER_MIN_SIM=0.15      # Min similarity to consider
CHAT_CROSS_ENCODER_BLEND=0.7         # Blend weight (0.7 = 70% cross-encoder, 30% original)
CHAT_CROSS_ENCODER_TTL_MS=600000     # Cache TTL (10 minutes)
CHAT_CROSS_ENCODER_CACHE_MAX=500     # Max cache entries

# LLM-based Reranking (slower, but more flexible - legacy)
CHAT_USE_RERANKER=false
CHAT_RERANK_MODEL=gpt-4o-mini
CHAT_RERANK_MODEL_STRONG=gpt-4o
CHAT_RERANK_HIGH_CONF=0.85
CHAT_RERANK_LOW_CONF=0.22
CHAT_RERANK_MAX_CANDIDATES=24
CHAT_RERANK_TOP_N=8
CHAT_RERANK_MIN_VEC=0.0
CHAT_RERANK_MIN_LEX=0.0
CHAT_RERANK_TTL_MS=3600000
CHAT_RERANK_CACHE_MAX=200

# 3. HNSW INDEX
# HNSW index is created by migration 017_hnsw_index.sql
# No environment variables needed - PostgreSQL automatically chooses best index
# To verify HNSW is active, check server logs during startup for:
# "âœ“ HNSW index created successfully!"
# or run: SELECT indexname FROM pg_indexes WHERE tablename = 'kb_entries' AND indexname LIKE '%hnsw%';



